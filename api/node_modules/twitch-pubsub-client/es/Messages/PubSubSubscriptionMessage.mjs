import { __awaiter, __decorate, __generator } from "tslib";
import { Enumerable } from '@d-fischer/shared-utils';
import { rtfm } from 'twitch-common';
/**
 * A message that informs about a user subscribing to a channel.
 */
var PubSubSubscriptionMessage = /** @class */ (function () {
    /** @private */
    function PubSubSubscriptionMessage(data, apiClient) {
        this._data = data;
        this._apiClient = apiClient;
    }
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "userId", {
        /**
         * The ID of the user subscribing to the channel.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift'
                ? this._data.recipient_id
                : this._data.user_id;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "userName", {
        /**
         * The name of the user subscribing to the channel.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift'
                ? this._data.recipient_user_name
                : this._data.user_name;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "userDisplayName", {
        /**
         * The display name of the user subscribing to the channel.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift'
                ? this._data.recipient_display_name
                : this._data.display_name;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "streakMonths", {
        /**
         * The streak amount of months the user has been subscribed for.
         *
         * Returns 0 if a gift sub or the streaks months.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift'
                ? 0
                : this._data.streak_months;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "cumulativeMonths", {
        /**
         * The cumulative amount of months the user has been subscribed for.
         *
         * Returns the months if a gift sub or the cumulative months.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift'
                ? this._data.months
                : this._data.cumulative_months;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "months", {
        /**
         * The cumulative amount of months the user has been subscribed for.
         *
         * Returns the months if a gift sub or the cumulative months.
         */
        get: function () {
            return this.cumulativeMonths;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "time", {
        /**
         * The time the user subscribed.
         */
        get: function () {
            return new Date(this._data.time);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "message", {
        /**
         * The message sent with the subscription.
         *
         * Returns null if the subscription is a gift subscription.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift' ? null : this._data.sub_message;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "subPlan", {
        /**
         * The plan of the subscription.
         */
        get: function () {
            return this._data.sub_plan;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "isResub", {
        /**
         * Whether the subscription is a resub.
         */
        get: function () {
            return this._data.context === 'resub';
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "isGift", {
        /**
         * Whether the subscription is a gift.
         */
        get: function () {
            return this._data.context === 'subgift';
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "isAnonymous", {
        /**
         * Whether the subscription is from an anonymous gifter.
         */
        get: function () {
            return this._data.context === 'anonsubgift';
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "gifterId", {
        /**
         * The ID of the user gifting the subscription.
         *
         * Returns null if the subscription is not a gift.
         */
        get: function () {
            return this.isGift ? this._data.user_id : null;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "gifterName", {
        /**
         * The name of the user gifting the subscription.
         *
         * Returns null if the subscription is not a gift.
         */
        get: function () {
            return this.isGift ? this._data.user_name : null;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "gifterDisplayName", {
        /**
         * The display name of the user gifting the subscription.
         *
         * Returns null if the subscription is not a gift.
         */
        get: function () {
            return this.isGift ? this._data.display_name : null;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PubSubSubscriptionMessage.prototype, "giftDuration", {
        /**
         * The duration of the gifted subscription, in months.
         *
         * Returns null if the subscription is not a gift.
         */
        get: function () {
            return this._data.context === 'subgift' || this._data.context === 'anonsubgift'
                ? this._data.multi_month_duration
                : null;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * Retrieves more information about the subscribing user.
     *
     * @deprecated Use {@HelixUserApi#getUserById} instead.
     */
    PubSubSubscriptionMessage.prototype.getUser = function () {
        return __awaiter(this, void 0, Promise, function () {
            return __generator(this, function (_a) {
                return [2 /*return*/, this._apiClient.helix.users.getUserById(this.userId)];
            });
        });
    };
    /**
     * Retrieves more information about the gifting user.
     *
     * Returns null if the subscription is not a gift.
     *
     * @deprecated Use {@HelixUserApi#getUserById} instead.
     */
    PubSubSubscriptionMessage.prototype.getGifter = function () {
        return __awaiter(this, void 0, Promise, function () {
            return __generator(this, function (_a) {
                if (!this.isGift) {
                    return [2 /*return*/, null];
                }
                return [2 /*return*/, this._apiClient.helix.users.getUserById(this.gifterId)];
            });
        });
    };
    __decorate([
        Enumerable(false)
    ], PubSubSubscriptionMessage.prototype, "_apiClient", void 0);
    __decorate([
        Enumerable(false)
    ], PubSubSubscriptionMessage.prototype, "_data", void 0);
    PubSubSubscriptionMessage = __decorate([
        rtfm('twitch-pubsub-client', 'PubSubSubscriptionMessage', 'userId')
    ], PubSubSubscriptionMessage);
    return PubSubSubscriptionMessage;
}());
export { PubSubSubscriptionMessage };
